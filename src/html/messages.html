<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PeerView - Messages</title>
  <link rel="stylesheet" href="peerview-styles.css"> <!-- Using external CSS -->
  <style>
    /* Additional clean layout for Messages */
    .content-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin: 20px;
    }

    .messages-layout {
      display: flex;
      margin-top: 20px;
    }

    .contact-list {
      width: 30%;
      border-right: 1px solid #ddd;
      padding-right: 15px;
    }

    .contact-item {
      margin-bottom: 15px;
      padding: 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    .contact-item:hover {
      background-color: #f5f5f5;
    }

    .chat-section {
      flex: 1;
      padding-left: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
    }

    .chat-bubble {
      background: #e0e0e0;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      max-width: 70%;
    }

    .chat-bubble.self {
      background: #a5d6a7;
      margin-left: auto;
    }

    .message-input {
      display: flex;
      margin-top: 10px;
    }

    .message-input input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
    }

    .message-input button {
      background-color: #28a745;
      border: none;
      color: white;
      padding: 8px 16px;
      margin-left: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <div class="logo">
        <a href="home.html">
          <img src="iowa logo.svg" alt="Iowa Logo">
        </a>
      </div>
      <nav>
        <ul>
          <li><a href = "home.html">Home</a></li>
          <li><a href = "connections.html">Connections</a></li>
          <li><strong><a href = "messages.html">Messages</a></strong></li>
          <li><a href = "invite.html">Send Invites</a></li>
        </ul>
      </nav>
    </div>
    <div class="settings">
      <button class="schedule-btn"><a href="settings.html">Settings</a></button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main">
    <!-- you might have to put functional code here -->
    <div class="header">
      <div class="user-dropdown">
        <button onclick="toggleUserMenu()">layiwola &#9662;</button>
        <div id="user-menu" class="dropdown-menu" style="display: none;">
          <a href="account.html">Account</a>
          <a href="signout.html">Sign Out</a>
        </div>
      </div>
    </div>   

    <!-- Messages Content -->
    <div class="content-section">
      <h3>Messages</h3>

      <div class="messages-layout">
        <!-- Contact List -->
        <div class="contact-list">
          <div class="search-bar">
            <input type="text" placeholder="Search contacts...">
          </div>

          <div class="contact-item" data-id="james" onclick="selectContact('james')">
            <strong>James Cameron</strong><br>
            <small>TA | College of Education</small><br />
            <small class="preview" style="color:rgba(0, 0, 0, 0.5)"></small>
          </div>
          
          <div class="contact-item" data-id="lucas" onclick="selectContact('lucas')">
            <strong>Lucas Ambrose</strong><br>
            <small>Professor | College of Business</small><br />
            <small class="preview" style="color:rgba(0, 0, 0, 0.5)"></small>
          </div>
          
          <div class="contact-item" data-id="emily" onclick="selectContact('emily')">
            <strong>Emily Vargas</strong><br>
            <small>TA | College of Liberal Arts</small><br />
            <small class="preview" style="color:rgba(0, 0, 0, 0.5)"></small>
          </div>          
        </div>

        <!-- Chat Section -->
        <div class="chat-section">
          <div id="chat-messages" class="chat-messages">
            <!-- Messages will be inserted here dynamically -->
          </div>
        
          <div class="message-input">
            <input id="message-input" type="text" placeholder="Type a message...">
            <button onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>

  </div>

</body>
<script>
  const chatMessages = document.getElementById("chat-messages");
  const messageInput = document.getElementById("message-input");

  let currentContact = null;

  const chatData = {
    james: [
      { from: "them", text: "Hey James, are you available next week?" },
      { from: "self", text: "Sure! How about Tuesday?" },
      { from: "them", text: "Tuesday works great. Thanks!" }
    ],
    lucas: [
      { from: "them", text: "Hi Professor Ambrose, can we discuss the project?" },
      { from: "self", text: "Yes, drop by my office hours tomorrow." }
    ],
    emily: [
      { from: "self", text: "Hey Emily, I appreciated your help last session!" },
      { from: "them", text: "No problem! Let me know if you need more guidance." }
    ]
  };

  function selectContact(contactId) {
    currentContact = contactId;
    const messages = chatData[contactId] || [];

    chatMessages.innerHTML = "";
    for (const msg of messages) {
      const bubble = document.createElement("div");
      bubble.className = "chat-bubble" + (msg.from === "self" ? " self" : "");
      bubble.innerText = msg.text;
      chatMessages.appendChild(bubble);
    }
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function sendMessage() {
    const text = messageInput.value.trim();
    if (!text || !currentContact) return;

    // Add to chatData
    chatData[currentContact] = chatData[currentContact] || [];
    chatData[currentContact].push({ from: "self", text });

    // Update chat window
    const bubble = document.createElement("div");
    bubble.className = "chat-bubble self";
    bubble.innerText = text;
    chatMessages.appendChild(bubble);

    // Scroll down and clear input
    chatMessages.scrollTop = chatMessages.scrollHeight;
    messageInput.value = "";
  }

  // Optional: Auto-select first contact on load
  window.onload = () => selectContact("james");

  // Dropdown when clicking on profile
  function toggleUserMenu() {
    const menu = document.getElementById("user-menu");
    menu.style.display = menu.style.display === "none" ? "block" : "none";
  }

  // Clicking anywhere outside will close dropdown
  document.addEventListener("click", function(event) {
    const dropdown = document.getElementById("user-menu");
    const button = event.target.closest(".user-dropdown");

    if (!button) {
      dropdown.style.display = "none";
    }
  });

  function updatePreviews() {
    document.querySelectorAll('.contact-item').forEach(item => {
      const id = item.getAttribute('data-id');
      const messages = chatData[id];
      const previewEl = item.querySelector('.preview');

      if (messages && messages.length > 0) {
        const lastMsg = messages[messages.length - 1].text;
        previewEl.textContent = lastMsg;
      } else {
        previewEl.textContent = "No messages yet.";
      }
    });
  }

  window.onload = () => {
    selectContact("james");
    updatePreviews();
  };

  function sendMessage() {
    const text = messageInput.value.trim();
    if (!text || !currentContact) return;

    chatData[currentContact] = chatData[currentContact] || [];
    chatData[currentContact].push({ from: "self", text });

    const bubble = document.createElement("div");
    bubble.className = "chat-bubble self";
    bubble.innerText = text;
    chatMessages.appendChild(bubble);

    chatMessages.scrollTop = chatMessages.scrollHeight;
    messageInput.value = "";

    updatePreviews(); // Update sidebar preview
  }
</script>
</html>
